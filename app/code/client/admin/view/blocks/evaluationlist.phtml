<table style="margin: 15px;">
<thead>
  <tr>
      <th>Code</th>
      <th>Faculty</th>
      <th>Status</th>
      <th>Action</th>
  </tr>
</thead>

<tbody>
	<?php 
		$accountDb = Core::getModel("account/account");
		$accountDataDb = Core::getModel("account/accountdata");
		$auth = Core::getSingleton("system/session")->get("auth");
		foreach( Core::getModel("admin/evaluation")->get() as $eval ) {
			$account = Core::getModel("account/account")->where("id", $eval->account_id)->first();
			$accountData = $accountDb->where("account_id", $account->id)->first();
			if( $accountDb->isAccountType("Dean") ) {
				$rs = $accountDataDb
					->where("account_id", $account->id)
					->where("college_dept_id", $accountDb->getDepartment($auth->id)->id)
					->exist();
				if(! $rs ) {continue;}
			}
			?>
			<tr>
				<td><?=$eval->code?></td>
				<td><?=Core::getModel("account/account")->getFullname($eval->account_id)?></td>
				<td><?=$eval->status?></td>
				<td>
					<a class="modal-trigger" href="#modal<?=$account->id?>">View</a> |
					<?php
						if( $eval->status == Core::getModel("evaluation/evaluation")::STATUS_ON_GOING ) {
							?>
							<a href="<?=Core::getBaseUrl()?>evaluation/evaluation/stop/id/<?=$eval->id?>" class="disabled">Stop</a> 
							<?php
						}else{
							?>
							<a href="<?=Core::getBaseUrl()?>evaluation/evaluation/resume/id/<?=$eval->id?>" class="disabled">Resume</a> 
							<?php 
								if( Core::getModel("account/account")->isAccountType("Admin") ) {
									?>
									|
							<a href="#modal-anal<?=$account->id?>" class="modal-trigger disabled">Analyse Result</a>
									<?php
								}

							?>

							<?php
						}
					?>
				</td>
				<!-- Modal Structure -->
				  <div id="modal<?=$account->id?>" class="modal">
				    <div class="modal-content center">
				    	<h4 style="color: #455b65;">View Evaluation Result</h4>
				    	<a href="<?=Core::getBaseUrl()?>admin/evaluation/view/student/1/id/<?=$account->id?>" class="btn" style="width: 185px;">Student</a>
				    	<a href="<?=Core::getBaseUrl()?>admin/evaluation/view/peer/1/id/<?=$account->id?>" class="btn" style="width: 185px;">Peer</a>
				    </div>
				  </div>

				  <!-- Modal Structure -->
				  <div id="modal-anal<?=$account->id?>" class="modal">
				    <div class="modal-content">
				    	<h4 style="color: #455b65;" class="center">Recommendation Support Module</h4><br>
				    	<div class="container" id="printme<?=$eval->id?>">
				    		<div class="row">
				    			<?php
				    			$adata = Core::getModel("account/accountdata")->where("account_id", $account->id)->first();
				    			?>
				    			<div class="col s6">Name: <?=$account->fname?> <?=$account->lname?></div>
				    			<div class="col s6">College Dep.: <?=$accountDb->getDepartment($account->id)->label?></div>
				    			<div class="col s6">Semester: <?=$adata->sem?></div>
				    			<div class="col s6">School Year: <?=$adata->scyear?></div>
				    		</div>
				    		<hr>
				    		<?php
				    			$dds = Core::getSingleton("admin/evaluation")->getEvaluationDdsData($eval->id);
				    			$recomend = $dds["recomendation"];
				    			$rating = $dds["overall"];
				    			unset($dds["recomendation"]);
				    			unset($dds["overall"]);
				    			$rating = 0;
				    			$noOfItems = 0;
				    			foreach( $dds as $ds ) {
				    				$rating = $rating + $ds["rating"];
				    				$noOfItems++;
				    				?>
				    				<div class="row">
							    		<div class="col s6">
							    			<?=$ds["label"]?>: <?=$ds["rating"]?>%
							    		</div>
							    	</div>
							    	<hr>
				    				<?php
				    			}
				    			// Core::log( $dds );
				    		?>
				    				<div class="row">
							    		<div class="col s6">
							    			Recomendation
							    		</div>
							    		<div class="col s6">
							    			<?=$recomend?>
							    		</div>
							    	</div>
							    	<hr>
							    	<div class="row">
							    		<div class="col s12">
							    			<span class="right">Average: <?=$rating / $noOfItems?>%</span>
							    		</div>
							    	</div>
							    	
				    </div>
				    	<div class="container">
				    		<a href="#" class="btn centered" onclick="PrintElem('printme<?=$eval->id?>')">Print</a>
				    	</div>
				    </div>
				  </div>


	
			</tr>
			<?php
		}
	?>
</tbody>
</table>

<script type="text/javascript">
function PrintElem(elem) {
    var mywindow = window.open('', 'PRINT', 'height=400,width=600');

    mywindow.document.write('<html><head><title>Report</title>');
    mywindow.document.write('</head><body >');
    mywindow.document.write('<h1>' + document.title  + ' Result</h1>');
    mywindow.document.write(document.getElementById(elem).innerHTML);
    mywindow.document.write('</body></html>');

    mywindow.document.close(); // necessary for IE >= 10
    mywindow.focus(); // necessary for IE >= 10*/

    mywindow.print();
    mywindow.close();

    return true;
}
</script>